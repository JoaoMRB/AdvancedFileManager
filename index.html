<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Gerenciador de Arquivos Avan√ßado</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üóÇÔ∏è</text></svg>">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        a {
            text-decoration: none;
            color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .drop-zone {
            border: 2px dashed #ccc;
            border-radius: 4px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            background-color: #fafafa;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .drop-zone:hover {
            border-color: #4CAF50;
            background-color: #f0f0f0;
        }
        .button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background-color 0.3s ease;
        }
        .button:hover {
            background-color: #45a049;
        }
        .button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        #fileList {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        .file-item {
            margin-bottom: 8px;
            padding: 8px;
            background-color: #f8f8f8;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .preview {
            color: #666;
            font-style: italic;
        }
        .options-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
            display: none;
        }
        .progress-bar-fill {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s ease;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
        }
        .tab.active {
            border-bottom: 2px solid #4CAF50;
            margin-bottom: -2px;
            color: #4CAF50;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        footer {
            background-color: #4CAF50;
            color: white;
            text-align: center;
            padding: 10px;
            font-size: 14px;
            border-radius: 0 0 8px 8px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Gerenciador de Arquivos Avan√ßado</h1>

        <div class="tabs">
            <button class="tab active" data-tab="rename">Renomear</button>
            <button class="tab" data-tab="case">Capitaliza√ß√£o</button>
            <button class="tab" data-tab="batch">Renomea√ß√£o em Lote</button>
        </div>

        <div id="renameTab" class="tab-content active">
            <div class="options-panel">
                <div class="input-group">
                    <label>Texto para Remover:</label>
                    <input type="text" id="textToRemove" placeholder="Ex: www.site.com -">
                </div>
                <div class="input-group">
                    <label>Texto para Adicionar:</label>
                    <input type="text" id="textToAdd" placeholder="Ex: [Processado]">
                    <select id="addPosition" style="margin-top: 5px">
                        <option value="start">No in√≠cio</option>
                        <option value="end">No final</option>
                    </select>
                </div>
            </div>
        </div>

        <div id="caseTab" class="tab-content">
            <div class="options-panel">
                <div class="input-group">
                    <label>Formato de Capitaliza√ß√£o:</label>
                    <select id="caseFormat">
                        <option value="lower">min√∫sculas</option>
                        <option value="upper">MAI√öSCULAS</option>
                        <option value="title">Primeira Letra Mai√∫scula</option>
                        <option value="sentence">Primeira letra da frase</option>
                    </select>
                </div>
            </div>
        </div>

        <div id="batchTab" class="tab-content">
            <div class="options-panel">
                <div class="input-group">
                    <label>Padr√£o de Renomea√ß√£o:</label>
                    <input type="text" id="batchPattern" placeholder="Ex: Arquivo_{n}">
                    <small style="display: block; margin-top: 5px; color: #666;">
                        Use {n} para n√∫mero sequencial, {ext} para extens√£o
                    </small>
                </div>
                <div class="input-group">
                    <label>N√∫mero Inicial:</label>
                    <input type="number" id="startNumber" value="1" min="0">
                </div>
            </div>
        </div>

        <div class="drop-zone" id="dropZone">
            Arraste um arquivo ZIP aqui ou clique para selecionar
            <input type="file" id="fileInput" accept=".zip" style="display: none">
        </div>

        <div class="progress-bar" id="progressBar">
            <div class="progress-bar-fill"></div>
        </div>

        <button id="processButton" class="button" disabled>Processar e Baixar</button>
        <button id="previewButton" class="button" disabled>Visualizar Altera√ß√µes</button>

        <div id="fileList"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        // Vari√°veis globais
        let zipFile = null;
        let originalFiles = [];
        
        // Elementos DOM
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const processButton = document.getElementById('processButton');
        const previewButton = document.getElementById('previewButton');
        const fileList = document.getElementById('fileList');
        const progressBar = document.getElementById('progressBar');
        const progressBarFill = document.querySelector('.progress-bar-fill');

        // Eventos das tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab + 'Tab').classList.add('active');
                
                if (zipFile) updatePreview();
            });
        });

        // Eventos de arrastar e soltar
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#4CAF50';
        });

        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#ccc';
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#ccc';
            
            const file = e.dataTransfer.files[0];
            if (file && file.type === 'application/zip') {
                handleFileSelect(file);
            }
        });

        dropZone.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                handleFileSelect(file);
            }
        });

        // Fun√ß√£o para processar sele√ß√£o de arquivo
        async function handleFileSelect(file) {
            zipFile = file;
            processButton.disabled = false;
            previewButton.disabled = false;
            
            const zip = new JSZip();
            try {
                const content = await zip.loadAsync(file);
                originalFiles = [];
                content.forEach((relativePath, zipEntry) => {
                    if (!zipEntry.dir) {
                        originalFiles.push(relativePath);
                    }
                });
                updatePreview();
            } catch (error) {
                fileList.innerHTML = `<div class="file-item" style="color: red">Erro ao ler o arquivo ZIP: ${error.message}</div>`;
            }
        }

        // Fun√ß√£o para processar o nome do arquivo
        function processFileName(originalName) {
            const activeTab = document.querySelector('.tab.active').dataset.tab;
            let newName = originalName;

            if (activeTab === 'rename') {
                const textToRemove = document.getElementById('textToRemove').value;
                const textToAdd = document.getElementById('textToAdd').value;
                const addPosition = document.getElementById('addPosition').value;

                if (textToRemove) {
                    newName = newName.replace(textToRemove, '');
                }

                if (textToAdd) {
                    const nameParts = newName.split('.');
                    if (nameParts.length > 1) {
                        const ext = nameParts.pop();
                        const baseName = nameParts.join('.');
                        newName = addPosition === 'start' 
                            ? `${textToAdd}${baseName}.${ext}`
                            : `${baseName}${textToAdd}.${ext}`;
                    }
                }
            } else if (activeTab === 'case') {
                const caseFormat = document.getElementById('caseFormat').value;
                const nameParts = newName.split('.');
                const ext = nameParts.pop();
                let baseName = nameParts.join('.');

                switch (caseFormat) {
                    case 'lower':
                        baseName = baseName.toLowerCase();
                        break;
                    case 'upper':
                        baseName = baseName.toUpperCase();
                        break;
                    case 'title':
                        baseName = baseName.split(' ')
                            .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
                            .join(' ');
                        break;
                    case 'sentence':
                        baseName = baseName.charAt(0).toUpperCase() + baseName.slice(1).toLowerCase();
                        break;
                }

                newName = `${baseName}.${ext}`;
            } else if (activeTab === 'batch') {
                const pattern = document.getElementById('batchPattern').value || 'File_{n}';
                const startNum = parseInt(document.getElementById('startNumber').value) || 1;
                const index = originalFiles.indexOf(originalName);
                const ext = originalName.split('.').pop();
                
                newName = pattern
                    .replace('{n}', (startNum + index).toString().padStart(1, '0'))
                    .replace('{ext}', ext);
                
                if (!newName.includes('.')) {
                    newName += '.' + ext;
                }
            }

            return newName;
        }

        // Fun√ß√£o para atualizar a pr√©via
        function updatePreview() {
            if (!originalFiles.length) return;

            let previewHtml = '<h3>Pr√©via das altera√ß√µes:</h3>';
            originalFiles.forEach(fileName => {
                const newName = processFileName(fileName);
                previewHtml += `
                    <div class="file-item">
                        <div>
                            <div>${fileName}</div>
                            <div class="preview">‚Üí ${newName}</div>
                        </div>
                    </div>`;
            });
            fileList.innerHTML = previewHtml;
        }

        // Evento do bot√£o de pr√©via
        previewButton.addEventListener('click', updatePreview);

        // Evento do bot√£o de processar
        processButton.addEventListener('click', async () => {
            if (!zipFile) return;

            processButton.disabled = true;
            previewButton.disabled = true;
            progressBar.style.display = 'block';
            
            try {
                const zip = new JSZip();
                const newZip = new JSZip();
                const content = await zip.loadAsync(zipFile);
                
                let processed = 0;
                const totalFiles = originalFiles.length;
                
                const promises = [];
                content.forEach((relativePath, zipEntry) => {
                    if (!zipEntry.dir) {
                        const newName = processFileName(relativePath);
                        const promise = zipEntry.async('uint8array').then(data => {
                            newZip.file(newName, data);
                            processed++;
                            progressBarFill.style.width = `${(processed / totalFiles) * 100}%`;
                        });
                        promises.push(promise);
                    }
                });

                await Promise.all(promises);

                const newZipBlob = await newZip.generateAsync({type: 'blob'});
                const downloadUrl = URL.createObjectURL(newZipBlob);
                const downloadLink = document.createElement('a');
                downloadLink.href = downloadUrl;
                downloadLink.download = 'arquivos_processados.zip';
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                URL.revokeObjectURL(downloadUrl);

                fileList.innerHTML += `<div class="file-item" style="color: green">Arquivos processados com sucesso!</div>`;
            } catch (error) {
                fileList.innerHTML += `<div class="file-item" style="color: red">Erro ao processar o arquivo: ${error.message}</div>`;
            } finally {
                    processButton.disabled = false;
                    previewButton.disabled = false;
                    setTimeout(() => {
                        progressBar.style.display = 'none';
                        progressBarFill.style.width = '0%';
                    }, 1000);
                }
            });

            // Adicionar eventos para atualiza√ß√£o autom√°tica da pr√©via
            document.getElementById('textToRemove').addEventListener('input', updatePreview);
            document.getElementById('textToAdd').addEventListener('input', updatePreview);
            document.getElementById('addPosition').addEventListener('change', updatePreview);
            document.getElementById('caseFormat').addEventListener('change', updatePreview);
            document.getElementById('batchPattern').addEventListener('input', updatePreview);
            document.getElementById('startNumber').addEventListener('input', updatePreview);

            // Fun√ß√£o para validar o padr√£o de renomea√ß√£o em lote
            function validateBatchPattern(pattern) {
                if (!pattern.includes('{n}') && !pattern.includes('{ext}')) {
                    return 'Arquivo_{n}';
                }
                return pattern;
            }

            // Fun√ß√£o para sanitizar nomes de arquivo
            function sanitizeFileName(fileName) {
                // Remove caracteres inv√°lidos para nomes de arquivo
                return fileName.replace(/[<>:"/\\|?*]/g, '_');
            }

            // Adicionar tratamento de erros global
            window.addEventListener('error', function(e) {
                fileList.innerHTML += `
                    <div class="file-item" style="color: red">
                        Ocorreu um erro inesperado. Por favor, tente novamente.
                    </div>`;
                console.error('Error:', e);
            });

            // Verificar suporte a recursos necess√°rios
            document.addEventListener('DOMContentLoaded', function() {
                if (!window.File || !window.FileReader || !window.FileList || !window.Blob) {
                    fileList.innerHTML = `
                        <div class="file-item" style="color: red">
                            Seu navegador n√£o suporta todas as funcionalidades necess√°rias.
                            Por favor, use um navegador mais recente.
                        </div>`;
                    processButton.disabled = true;
                    previewButton.disabled = true;
                }
            });

            // Adicionar limite de tamanho de arquivo
            const MAX_FILE_SIZE = 500 * 1024 * 1024; // 100MB
            function validateFileSize(file) {
                if (file.size > MAX_FILE_SIZE) {
                    fileList.innerHTML = `
                        <div class="file-item" style="color: red">
                            O arquivo √© muito grande. O tamanho m√°ximo permitido √© 500MB.
                        </div>`;
                    return false;
                }
                return true;
            }

            // Atualizar a fun√ß√£o handleFileSelect para incluir valida√ß√£o de tamanho
            async function handleFileSelect(file) {
                if (!validateFileSize(file)) {
                    processButton.disabled = true;
                    previewButton.disabled = true;
                    return;
                }
                
                zipFile = file;
                processButton.disabled = false;
                previewButton.disabled = false;
                
                const zip = new JSZip();
                try {
                    const content = await zip.loadAsync(file);
                    originalFiles = [];
                    content.forEach((relativePath, zipEntry) => {
                        if (!zipEntry.dir) {
                            originalFiles.push(relativePath);
                        }
                    });
                    updatePreview();
                    
                    // Mostrar quantidade de arquivos encontrados
                    fileList.innerHTML = `
                        <div class="file-item" style="color: green">
                            ${originalFiles.length} arquivos encontrados no ZIP.
                        </div>` + fileList.innerHTML;
                } catch (error) {
                    fileList.innerHTML = `
                        <div class="file-item" style="color: red">
                            Erro ao ler o arquivo ZIP: ${error.message}
                        </div>`;
                }
            }
    </script>
    <footer>
        Criado por <a href="https://github.com/JoaoMRB">@JoaoRb</a>
    </footer>
            </body>
            </html>